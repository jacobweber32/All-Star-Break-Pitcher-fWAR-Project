% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Predictive Baseball Model Using Plus Minus Stats},
  pdfauthor={Jacob Weber},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Predictive Baseball Model Using Plus Minus Stats}
\author{Jacob Weber}
\date{2024-07-18}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'dplyr'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     filter, lag
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(purrr)}
\FunctionTok{library}\NormalTok{(randomForest)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## randomForest 4.7-1.1
\end{verbatim}

\begin{verbatim}
## Type rfNews() to see new features/changes/bug fixes.
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'randomForest'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:dplyr':
## 
##     combine
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(baseballr)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Data Scraping}
\NormalTok{fg\_2021\_data }\OtherTok{\textless{}{-}} \FunctionTok{fg\_pitch\_leaders}\NormalTok{( }\AttributeTok{startseason =} \StringTok{"2021"}\NormalTok{, }\AttributeTok{endseason =} \StringTok{"2021"}\NormalTok{, }\AttributeTok{qual =} \DecValTok{0}\NormalTok{)}
\NormalTok{fg\_2022\_data }\OtherTok{\textless{}{-}} \FunctionTok{fg\_pitch\_leaders}\NormalTok{( }\AttributeTok{startseason =} \StringTok{"2022"}\NormalTok{, }\AttributeTok{endseason =} \StringTok{"2022"}\NormalTok{, }\AttributeTok{qual =} \DecValTok{0}\NormalTok{)}
\NormalTok{fg\_2023\_data }\OtherTok{\textless{}{-}} \FunctionTok{fg\_pitch\_leaders}\NormalTok{( }\AttributeTok{startseason =} \StringTok{"2023"}\NormalTok{, }\AttributeTok{endseason =} \StringTok{"2023"}\NormalTok{, }\AttributeTok{qual =} \DecValTok{0}\NormalTok{)}
\NormalTok{All\_Star\_Break\_2024 }\OtherTok{\textless{}{-}} \FunctionTok{fg\_pitch\_leaders}\NormalTok{( }\AttributeTok{startseason =} \StringTok{"2024"}\NormalTok{, }\AttributeTok{endseason =} \StringTok{"2024"}\NormalTok{, }\AttributeTok{qual =} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function to calculate age factor}
\NormalTok{calculate\_age\_factor }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(age) \{}
  \ControlFlowTok{if}\NormalTok{ (age }\SpecialCharTok{\textless{}} \DecValTok{27}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ (}\DecValTok{27} \SpecialCharTok{{-}}\NormalTok{ age) }\SpecialCharTok{*} \FloatTok{0.01}\NormalTok{)  }\CommentTok{\# Slight progression for younger players}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (age }\SpecialCharTok{\textgreater{}=} \DecValTok{27} \SpecialCharTok{\&\&}\NormalTok{ age }\SpecialCharTok{\textless{}} \DecValTok{29}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ (}\DecValTok{29} \SpecialCharTok{{-}}\NormalTok{ age) }\SpecialCharTok{*} \FloatTok{0.02}\NormalTok{)  }\CommentTok{\# More significant progression}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (age }\SpecialCharTok{\textgreater{}=} \DecValTok{29} \SpecialCharTok{\&\&}\NormalTok{ age }\SpecialCharTok{\textless{}} \DecValTok{31}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ (}\DecValTok{31} \SpecialCharTok{{-}}\NormalTok{ age) }\SpecialCharTok{*} \FloatTok{0.01}\NormalTok{)  }\CommentTok{\# Slight progression}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (age }\SpecialCharTok{\textgreater{}=} \DecValTok{31} \SpecialCharTok{\&\&}\NormalTok{ age }\SpecialCharTok{\textless{}} \DecValTok{35}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ (age }\SpecialCharTok{{-}} \DecValTok{31}\NormalTok{) }\SpecialCharTok{*} \FloatTok{0.02}\NormalTok{)  }\CommentTok{\# Moderate regression}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \FunctionTok{return}\NormalTok{(}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ (age }\SpecialCharTok{{-}} \DecValTok{35}\NormalTok{) }\SpecialCharTok{*} \FloatTok{0.03}\NormalTok{)  }\CommentTok{\# More significant regression for older players}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function to inverse metrics where lower is better}
\NormalTok{inverse\_metric }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{return}\NormalTok{(}\DecValTok{1} \SpecialCharTok{/}\NormalTok{ (x }\SpecialCharTok{+} \DecValTok{1}\NormalTok{))  }\CommentTok{\# Adding 1 to avoid division by zero}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# List of all dataframes}
\NormalTok{all\_dfs }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(fg\_2021\_data, fg\_2022\_data, fg\_2023\_data, All\_Star\_Break\_2024)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Get common column names across all dataframes}
\NormalTok{common\_cols }\OtherTok{\textless{}{-}} \FunctionTok{reduce}\NormalTok{(}\FunctionTok{map}\NormalTok{(all\_dfs, colnames), intersect)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Ensure G and GS are included in common\_cols}
\NormalTok{common\_cols }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(common\_cols, }\StringTok{"G"}\NormalTok{, }\StringTok{"GS"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function to select common columns, add Year, and keep Name and ID columns}
\NormalTok{select\_common\_cols }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, year) \{}
\NormalTok{  df }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(common\_cols), PlayerName, playerid, G, GS) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Year =}\NormalTok{ year,}
           \AttributeTok{is\_starter =} \FunctionTok{ifelse}\NormalTok{(GS }\SpecialCharTok{\textgreater{}}\NormalTok{ (G }\SpecialCharTok{{-}}\NormalTok{ GS), }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))  }\CommentTok{\# Add is\_starter here}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Apply the function to each dataframe and combine all data}
\NormalTok{all\_data }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(}
  \FunctionTok{select\_common\_cols}\NormalTok{(fg\_2021\_data, }\DecValTok{2021}\NormalTok{),}
  \FunctionTok{select\_common\_cols}\NormalTok{(fg\_2022\_data, }\DecValTok{2022}\NormalTok{),}
  \FunctionTok{select\_common\_cols}\NormalTok{(fg\_2023\_data, }\DecValTok{2023}\NormalTok{),}
  \FunctionTok{select\_common\_cols}\NormalTok{(All\_Star\_Break\_2024, }\DecValTok{2024}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Print the column names of the combined data}
\FunctionTok{print}\NormalTok{(}\StringTok{"Columns in combined data:"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Columns in combined data:"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{colnames}\NormalTok{(all\_data))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   [1] "Season"            "team_name"         "Throws"           
##   [4] "xMLBAMID"          "PlayerNameRoute"   "PlayerName"       
##   [7] "playerid"          "Age"               "AgeRng"           
##  [10] "SeasonMin"         "SeasonMax"         "W"                
##  [13] "L"                 "ERA"               "G"                
##  [16] "GS"                "QS"                "CG"               
##  [19] "ShO"               "SV"                "BS"               
##  [22] "IP"                "TBF"               "H"                
##  [25] "R"                 "ER"                "HR"               
##  [28] "BB"                "IBB"               "HBP"              
##  [31] "WP"                "BK"                "SO"               
##  [34] "GB"                "FB"                "LD"               
##  [37] "IFFB"              "Pitches"           "Balls"            
##  [40] "Strikes"           "RS"                "IFH"              
##  [43] "BU"                "BUH"               "K_9"              
##  [46] "BB_9"              "K_BB"              "H_9"              
##  [49] "HR_9"              "AVG"               "WHIP"             
##  [52] "BABIP"             "LOB_pct"           "FIP"              
##  [55] "GB_FB"             "LD_pct"            "GB_pct"           
##  [58] "FB_pct"            "IFFB_pct"          "HR_FB"            
##  [61] "IFH_pct"           "BUH_pct"           "TTO_pct"          
##  [64] "CFraming"          "Starting"          "Start_IP"         
##  [67] "RAR"               "WAR"               "Dollars"          
##  [70] "RA9-Wins"          "LOB-Wins"          "BIP-Wins"         
##  [73] "BS-Wins"           "tERA"              "xFIP"             
##  [76] "WPA"               "WPA_minus"         "WPA_plus"         
##  [79] "RE24"              "REW"               "pLI"              
##  [82] "inLI"              "gmLI"              "exLI"             
##  [85] "Pulls"             "Games"             "WPA_LI"           
##  [88] "Clutch"            "FB_pct1"           "FBv"              
##  [91] "SL_pct"            "SLv"               "CT_pct"           
##  [94] "CTv"               "CB_pct"            "CBv"              
##  [97] "CH_pct"            "CHv"               "wFB"              
## [100] "wSL"               "wCT"               "wCB"              
## [103] "wCH"               "wFB_C"             "wSL_C"            
## [106] "wCT_C"             "wCB_C"             "wCH_C"            
## [109] "O-Swing_pct"       "Z-Swing_pct"       "Swing_pct"        
## [112] "O-Contact_pct"     "Z-Contact_pct"     "Contact_pct"      
## [115] "Zone_pct"          "F-Strike_pct"      "SwStr_pct"        
## [118] "CStr_pct"          "C+SwStr_pct"       "HLD"              
## [121] "SD"                "MD"                "ERA-"             
## [124] "FIP-"              "xFIP-"             "K_pct"            
## [127] "BB_pct"            "K-BB_pct"          "SIERA"            
## [130] "kwERA"             "RS_9"              "E-F"              
## [133] "Pull"              "Cent"              "Oppo"             
## [136] "Soft"              "Med"               "Hard"             
## [139] "bipCount"          "Pull_pct"          "Cent_pct"         
## [142] "Oppo_pct"          "Soft_pct"          "Med_pct"          
## [145] "Hard_pct"          "K_9+"              "BB_9+"            
## [148] "K_BB+"             "H_9+"              "HR_9+"            
## [151] "AVG+"              "WHIP+"             "BABIP+"           
## [154] "LOB_pct+"          "K_pct+"            "BB_pct+"          
## [157] "LD_pct+"           "GB_pct+"           "FB_pct+"          
## [160] "HRFB_pct+"         "Pull_pct+"         "Cent_pct+"        
## [163] "Oppo_pct+"         "Soft_pct+"         "Med_pct+"         
## [166] "Hard_pct+"         "xERA"              "pb_o_CH"          
## [169] "pb_s_CH"           "pb_c_CH"           "pb_o_CU"          
## [172] "pb_s_CU"           "pb_c_CU"           "pb_o_FF"          
## [175] "pb_s_FF"           "pb_c_FF"           "pb_o_SI"          
## [178] "pb_s_SI"           "pb_c_SI"           "pb_o_SL"          
## [181] "pb_s_SL"           "pb_c_SL"           "pb_o_FC"          
## [184] "pb_s_FC"           "pb_c_FC"           "pb_overall"       
## [187] "pb_stuff"          "pb_command"        "pb_xRV100"        
## [190] "pb_ERA"            "sp_s_CH"           "sp_l_CH"          
## [193] "sp_p_CH"           "sp_s_CU"           "sp_l_CU"          
## [196] "sp_p_CU"           "sp_s_FF"           "sp_l_FF"          
## [199] "sp_p_FF"           "sp_s_SI"           "sp_l_SI"          
## [202] "sp_p_SI"           "sp_s_SL"           "sp_l_SL"          
## [205] "sp_p_SL"           "sp_s_FC"           "sp_l_FC"          
## [208] "sp_p_FC"           "sp_stuff"          "sp_location"      
## [211] "sp_pitching"       "DGV"               "rFTeamV"          
## [214] "rBTeamV"           "rTV"               "pfx_FA_pct"       
## [217] "pfx_FC_pct"        "pfx_SI_pct"        "pfx_SL_pct"       
## [220] "pfx_CU_pct"        "pfx_CH_pct"        "pfx_vFA"          
## [223] "pfx_vFC"           "pfx_vSI"           "pfx_vSL"          
## [226] "pfx_vCU"           "pfx_vCH"           "pfx_FA-X"         
## [229] "pfx_FC-X"          "pfx_SI-X"          "pfx_SL-X"         
## [232] "pfx_CU-X"          "pfx_CH-X"          "pfx_FA-Z"         
## [235] "pfx_FC-Z"          "pfx_SI-Z"          "pfx_SL-Z"         
## [238] "pfx_CU-Z"          "pfx_CH-Z"          "pfx_wFA"          
## [241] "pfx_wFC"           "pfx_wSI"           "pfx_wSL"          
## [244] "pfx_wCU"           "pfx_wCH"           "pfx_wFA_C"        
## [247] "pfx_wFC_C"         "pfx_wSI_C"         "pfx_wSL_C"        
## [250] "pfx_wCU_C"         "pfx_wCH_C"         "pfx_O-Swing_pct"  
## [253] "pfx_Z-Swing_pct"   "pfx_Swing_pct"     "pfx_O-Contact_pct"
## [256] "pfx_Z-Contact_pct" "pfx_Contact_pct"   "pfx_Zone_pct"     
## [259] "pfx_Pace"          "pi_CH_pct"         "pi_CU_pct"        
## [262] "pi_FA_pct"         "pi_FC_pct"         "pi_SI_pct"        
## [265] "pi_SL_pct"         "pi_vCH"            "pi_vCU"           
## [268] "pi_vFA"            "pi_vFC"            "pi_vSI"           
## [271] "pi_vSL"            "pi_CH-X"           "pi_CU-X"          
## [274] "pi_FA-X"           "pi_FC-X"           "pi_SI-X"          
## [277] "pi_SL-X"           "pi_CH-Z"           "pi_CU-Z"          
## [280] "pi_FA-Z"           "pi_FC-Z"           "pi_SI-Z"          
## [283] "pi_SL-Z"           "pi_wCH"            "pi_wCU"           
## [286] "pi_wFA"            "pi_wFC"            "pi_wSI"           
## [289] "pi_wSL"            "pi_wCH_C"          "pi_wCU_C"         
## [292] "pi_wFA_C"          "pi_wFC_C"          "pi_wSI_C"         
## [295] "pi_wSL_C"          "pi_O-Swing_pct"    "pi_Z-Swing_pct"   
## [298] "pi_Swing_pct"      "pi_O-Contact_pct"  "pi_Z-Contact_pct" 
## [301] "pi_Contact_pct"    "pi_Zone_pct"       "pi_Pace"          
## [304] "Events"            "EV"                "LA"               
## [307] "Barrels"           "Barrel_pct"        "maxEV"            
## [310] "HardHit"           "HardHit_pct"       "Q"                
## [313] "TG"                "TIP"               "position"         
## [316] "team_name_abb"     "teamid"            "SF_pct"           
## [319] "SFv"               "XX_pct"            "wSF"              
## [322] "wSF_C"             "pfx_FS_pct"        "pfx_vFS"          
## [325] "pfx_FS-X"          "pfx_FS-Z"          "pfx_wFS"          
## [328] "pfx_wFS_C"         "pi_FS_pct"         "pi_vFS"           
## [331] "pi_FS-X"           "pi_FS-Z"           "pi_wFS"           
## [334] "pi_wFS_C"          "pb_o_FS"           "pb_s_FS"          
## [337] "pb_c_FS"           "sp_s_FS"           "sp_l_FS"          
## [340] "sp_p_FS"           "pb_o_KC"           "pb_s_KC"          
## [343] "pb_c_KC"           "sp_s_KC"           "sp_l_KC"          
## [346] "sp_p_KC"           "pfx_KC_pct"        "pfx_vKC"          
## [349] "pfx_KC-X"          "pfx_KC-Z"          "pfx_wKC"          
## [352] "pfx_wKC_C"         "Relieving"         "Relief_IP"        
## [355] "pi_XX_pct"         "pi_vXX"            "pi_XX-X"          
## [358] "pi_XX-Z"           "pi_wXX"            "pi_wXX_C"         
## [361] "pi_CS_pct"         "pi_vCS"            "pi_CS-X"          
## [364] "pi_CS-Z"           "pi_wCS"            "pi_wCS_C"         
## [367] "pfx_EP_pct"        "pfx_vEP"           "pfx_EP-X"         
## [370] "pfx_EP-Z"          "pfx_wEP"           "pfx_wEP_C"        
## [373] "KN_pct"            "KNv"               "wKN"              
## [376] "wKN_C"             "pfx_KN_pct"        "pfx_vKN"          
## [379] "pfx_KN-X"          "pfx_KN-Z"          "pfx_wKN"          
## [382] "pfx_wKN_C"         "pi_KN_pct"         "pi_vKN"           
## [385] "pi_KN-X"           "pi_KN-Z"           "pi_wKN"           
## [388] "pi_wKN_C"          "Year"              "is_starter"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Select features for the model (adjust these based on the available columns)}
\NormalTok{features }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Age"}\NormalTok{, }\StringTok{"IP"}\NormalTok{, }\StringTok{"K\_pct"}\NormalTok{, }\StringTok{"BB\_pct"}\NormalTok{, }\StringTok{"ERA{-}"}\NormalTok{, }\StringTok{"FIP{-}"}\NormalTok{, }\StringTok{"BABIP"}\NormalTok{, }\StringTok{"GB\_pct"}\NormalTok{, }\StringTok{"FB\_pct"}\NormalTok{, }\StringTok{"WHIP+"}\NormalTok{)}
\NormalTok{target }\OtherTok{\textless{}{-}} \StringTok{"WAR"}  \CommentTok{\# adjust if needed}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Check if all required columns are present}
\NormalTok{missing\_cols }\OtherTok{\textless{}{-}} \FunctionTok{setdiff}\NormalTok{(}\FunctionTok{c}\NormalTok{(features, target), }\FunctionTok{colnames}\NormalTok{(all\_data))}
\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{length}\NormalTok{(missing\_cols) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
  \FunctionTok{stop}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Missing columns:"}\NormalTok{, }\FunctionTok{paste}\NormalTok{(missing\_cols, }\AttributeTok{collapse =} \StringTok{", "}\NormalTok{)))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Prepare the data}
\NormalTok{model\_data }\OtherTok{\textless{}{-}}\NormalTok{ all\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(PlayerName, playerid, }\FunctionTok{all\_of}\NormalTok{(}\FunctionTok{c}\NormalTok{(features, target, }\StringTok{"Year"}\NormalTok{, }\StringTok{"G"}\NormalTok{, }\StringTok{"GS"}\NormalTok{, }\StringTok{"is\_starter"}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{ERA\_minus\_inv =} \FunctionTok{inverse\_metric}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{ERA{-}}\StringTok{\textasciigrave{}}\NormalTok{),}
    \AttributeTok{FIP\_minus\_inv =} \FunctionTok{inverse\_metric}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{FIP{-}}\StringTok{\textasciigrave{}}\NormalTok{),}
    \AttributeTok{WHIP\_plus\_inc =} \FunctionTok{inverse\_metric}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{WHIP+}\StringTok{\textasciigrave{}}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{na.omit}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Update features list for the model}
\NormalTok{model\_features }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Age"}\NormalTok{, }\StringTok{"IP"}\NormalTok{, }\StringTok{"K\_pct"}\NormalTok{, }\StringTok{"BB\_pct"}\NormalTok{, }\StringTok{"ERA\_minus\_inv"}\NormalTok{, }\StringTok{"FIP\_minus\_inv"}\NormalTok{, }\StringTok{"BABIP"}\NormalTok{, }\StringTok{"GB\_pct"}\NormalTok{, }\StringTok{"FB\_pct"}\NormalTok{, }\StringTok{"WHIP\_plus\_inc"}\NormalTok{)}
\NormalTok{model\_features }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(model\_features, }\StringTok{"is\_starter"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Split the data}
\NormalTok{train\_data }\OtherTok{\textless{}{-}}\NormalTok{ model\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(Year }\SpecialCharTok{\textless{}} \DecValTok{2024}\NormalTok{)}
\NormalTok{test\_data }\OtherTok{\textless{}{-}}\NormalTok{ model\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(Year }\SpecialCharTok{==} \DecValTok{2024}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Ensure True/False variable is Numeric }
\NormalTok{test\_data }\OtherTok{\textless{}{-}}\NormalTok{ test\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{is\_starter =} \FunctionTok{as.numeric}\NormalTok{(is\_starter))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Create weights based on the year}
\NormalTok{train\_data }\OtherTok{\textless{}{-}}\NormalTok{ train\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{weight =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    Year }\SpecialCharTok{==} \DecValTok{2023} \SpecialCharTok{\textasciitilde{}} \DecValTok{3}\NormalTok{,}
\NormalTok{    Year }\SpecialCharTok{==} \DecValTok{2022} \SpecialCharTok{\textasciitilde{}} \DecValTok{2}\NormalTok{,}
\NormalTok{    Year }\SpecialCharTok{==} \DecValTok{2021} \SpecialCharTok{\textasciitilde{}} \DecValTok{1}
\NormalTok{  ))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Ensuring is\_starter is included}
\NormalTok{train\_data }\OtherTok{\textless{}{-}}\NormalTok{ train\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{GR =}\NormalTok{ G }\SpecialCharTok{{-}}\NormalTok{ GS,}
         \AttributeTok{is\_starter =}\NormalTok{ GS }\SpecialCharTok{\textgreater{}}\NormalTok{ GR)}

\NormalTok{test\_data }\OtherTok{\textless{}{-}}\NormalTok{ test\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{GR =}\NormalTok{ G }\SpecialCharTok{{-}}\NormalTok{ GS,}
         \AttributeTok{is\_starter =} \FunctionTok{as.numeric}\NormalTok{(GS }\SpecialCharTok{\textgreater{}}\NormalTok{ GR))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Prepare data for modeling}
\NormalTok{train\_data\_model }\OtherTok{\textless{}{-}}\NormalTok{ train\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(}\FunctionTok{c}\NormalTok{(model\_features, target, }\StringTok{"is\_starter"}\NormalTok{)))}
\NormalTok{test\_data\_model }\OtherTok{\textless{}{-}}\NormalTok{ test\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(}\FunctionTok{c}\NormalTok{(model\_features, }\StringTok{"is\_starter"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Calculate the proportion of the season remaining}
\NormalTok{games\_played }\OtherTok{\textless{}{-}} \DecValTok{97}  \CommentTok{\# Average number of games played so far}
\NormalTok{total\_games }\OtherTok{\textless{}{-}} \DecValTok{162}
\NormalTok{remaining\_season\_factor }\OtherTok{\textless{}{-}}\NormalTok{ (total\_games }\SpecialCharTok{{-}}\NormalTok{ games\_played) }\SpecialCharTok{/}\NormalTok{ total\_games}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Train the model with weights}
\NormalTok{rf\_model }\OtherTok{\textless{}{-}} \FunctionTok{randomForest}\NormalTok{(}
  \FunctionTok{as.formula}\NormalTok{(}\FunctionTok{paste}\NormalTok{(target, }\StringTok{"\textasciitilde{} ."}\NormalTok{)), }
  \AttributeTok{data =}\NormalTok{ train\_data\_model, }
  \AttributeTok{weights =}\NormalTok{ train\_data}\SpecialCharTok{$}\NormalTok{weight,}
  \AttributeTok{importance =} \ConstantTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Make predictions for the rest of the season}
\NormalTok{full\_season\_predictions }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(rf\_model, test\_data\_model)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Function to calculate remaining WAR based on role}
\NormalTok{calculate\_remaining\_war }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(current\_war, predicted\_full\_season\_war, ip, age, is\_starter) \{}
  \CommentTok{\# Calculate the league{-}leading pace}
\NormalTok{  league\_leading\_pace }\OtherTok{\textless{}{-}} \FunctionTok{max}\NormalTok{(}\DecValTok{9}\NormalTok{, }\FunctionTok{max}\NormalTok{(current\_war) }\SpecialCharTok{/}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ remaining\_season\_factor))}
  
  \CommentTok{\# Adjustment factor for young, underperforming players}
\NormalTok{  youth\_improvement\_factor }\OtherTok{\textless{}{-}} \ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textless{}} \DecValTok{26} \SpecialCharTok{\&\&}\NormalTok{ current\_war }\SpecialCharTok{\textless{}} \DecValTok{1}\NormalTok{) \{}
    \FunctionTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1} \SpecialCharTok{+}\NormalTok{ (}\DecValTok{26} \SpecialCharTok{{-}}\NormalTok{ age) }\SpecialCharTok{*} \FloatTok{0.1}\NormalTok{)  }\CommentTok{\# Up to 50\% improvement for very young players}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(age }\SpecialCharTok{\textless{}} \DecValTok{28} \SpecialCharTok{\&\&}\NormalTok{ current\_war }\SpecialCharTok{\textless{}} \FloatTok{1.5}\NormalTok{) \{}
    \FunctionTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1} \SpecialCharTok{+}\NormalTok{ (}\DecValTok{28} \SpecialCharTok{{-}}\NormalTok{ age) }\SpecialCharTok{*} \FloatTok{0.05}\NormalTok{)  }\CommentTok{\# Up to 25\% improvement for young players}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \DecValTok{1}
\NormalTok{  \}}
  
  \CommentTok{\# Adjust the full season prediction}
  \ControlFlowTok{if}\NormalTok{ (current\_war }\SpecialCharTok{\textgreater{}} \DecValTok{3}\NormalTok{) \{}
    \CommentTok{\# For top performers, ensure we\textquotesingle{}re not projecting significant negative WAR}
\NormalTok{    adjusted\_full\_season }\OtherTok{=} \FunctionTok{max}\NormalTok{(predicted\_full\_season\_war, current\_war }\SpecialCharTok{*} \FloatTok{1.2}\NormalTok{)}
\NormalTok{    adjusted\_full\_season }\OtherTok{=} \FunctionTok{min}\NormalTok{(adjusted\_full\_season, league\_leading\_pace)}
\NormalTok{  \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (current\_war }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
    \CommentTok{\# For positive but not elite performers, allow for more upside}
\NormalTok{    adjusted\_full\_season }\OtherTok{=}\NormalTok{ predicted\_full\_season\_war }\SpecialCharTok{*} \FunctionTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\FloatTok{1.2}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ youth\_improvement\_factor}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \CommentTok{\# For negative performers, allow for both improvement and continued struggles}
\NormalTok{    adjusted\_full\_season }\OtherTok{=}\NormalTok{ predicted\_full\_season\_war }\SpecialCharTok{*} \FunctionTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{0.8}\NormalTok{, }\FloatTok{1.2}\NormalTok{) }\SpecialCharTok{*}\NormalTok{ youth\_improvement\_factor}
\NormalTok{  \}}
  
\NormalTok{  remaining\_war }\OtherTok{\textless{}{-}}\NormalTok{ (adjusted\_full\_season }\SpecialCharTok{{-}}\NormalTok{ current\_war)}
  
  \CommentTok{\# Adjust for starters vs relievers}
  \ControlFlowTok{if}\NormalTok{ (is\_starter }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{}
\NormalTok{    remaining\_starts }\OtherTok{\textless{}{-}} \DecValTok{12}  \CommentTok{\# Average remaining starts for a starter}
\NormalTok{    total\_starts }\OtherTok{\textless{}{-}} \DecValTok{32}  \CommentTok{\# Approximate total starts in a full season}
\NormalTok{    remaining\_war }\OtherTok{\textless{}{-}}\NormalTok{ remaining\_war }\SpecialCharTok{*}\NormalTok{ (remaining\_starts }\SpecialCharTok{/}\NormalTok{ total\_starts) }\SpecialCharTok{*} \FloatTok{1.4}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \CommentTok{\# For relievers, use the remaining season factor}
\NormalTok{    remaining\_war }\OtherTok{\textless{}{-}}\NormalTok{ remaining\_war }\SpecialCharTok{*}\NormalTok{ remaining\_season\_factor }\SpecialCharTok{*} \FloatTok{1.2}
\NormalTok{  \}}
  
  \CommentTok{\# Apply the 3.7 WAR cap}
\NormalTok{  remaining\_war }\OtherTok{\textless{}{-}} \FunctionTok{min}\NormalTok{(remaining\_war, }\FloatTok{3.7}\NormalTok{)}
  
  \CommentTok{\# Allow for variation in performance}
\NormalTok{  variation\_factor }\OtherTok{\textless{}{-}} \FunctionTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FloatTok{0.8}\NormalTok{, }\FloatTok{1.2}\NormalTok{)}
\NormalTok{  remaining\_war }\OtherTok{\textless{}{-}}\NormalTok{ remaining\_war }\SpecialCharTok{*}\NormalTok{ variation\_factor}
  
  \FunctionTok{return}\NormalTok{(remaining\_war)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Calculate remaining WAR}
\NormalTok{test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Remaining\_WAR }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(calculate\_remaining\_war, }
\NormalTok{                                            test\_data}\SpecialCharTok{$}\NormalTok{WAR, }
\NormalTok{                                            full\_season\_predictions, }
\NormalTok{                                            test\_data}\SpecialCharTok{$}\NormalTok{IP,}
\NormalTok{                                            test\_data}\SpecialCharTok{$}\NormalTok{Age,}
\NormalTok{                                            test\_data}\SpecialCharTok{$}\NormalTok{is\_starter)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Calculate full season WAR}
\NormalTok{test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Full\_Season\_WAR }\OtherTok{\textless{}{-}}\NormalTok{ test\_data}\SpecialCharTok{$}\NormalTok{WAR }\SpecialCharTok{+}\NormalTok{ test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Remaining\_WAR}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Evaluate the model}
\NormalTok{mse }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{((test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Remaining\_WAR }\SpecialCharTok{{-}}\NormalTok{ (test\_data[[target]] }\SpecialCharTok{{-}}\NormalTok{ test\_data}\SpecialCharTok{$}\NormalTok{WAR) }\SpecialCharTok{*}\NormalTok{ remaining\_season\_factor)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Manual R{-}squared calculation}
\NormalTok{actual }\OtherTok{\textless{}{-}}\NormalTok{ test\_data}\SpecialCharTok{$}\NormalTok{WAR}
\NormalTok{predicted }\OtherTok{\textless{}{-}}\NormalTok{ test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Full\_Season\_WAR}
\NormalTok{SSR }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{((predicted }\SpecialCharTok{{-}}\NormalTok{ actual)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{SST }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{((actual }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(actual))}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{r\_squared }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ SSR}\SpecialCharTok{/}\NormalTok{SST}

\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"MSE:"}\NormalTok{, mse))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "MSE: 0.00903908615110667"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"R{-}squared:"}\NormalTok{, r\_squared))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "R-squared: 0.9828364821188"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Feature importance}
\NormalTok{importance }\OtherTok{\textless{}{-}} \FunctionTok{importance}\NormalTok{(rf\_model)}
\FunctionTok{print}\NormalTok{(importance)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                 %IncMSE IncNodePurity
## Age            3.981416      20.08211
## IP            62.473915    1094.41036
## K_pct         19.754421     142.11883
## BB_pct        13.584552      79.76326
## ERA_minus_inv 24.675535     232.56515
## FIP_minus_inv 56.104948     605.77025
## BABIP         18.467308      71.63797
## GB_pct         9.003068      26.25273
## FB_pct         9.659776      30.30112
## WHIP_plus_inc 19.482212     215.56385
## is_starter    24.531868     313.93230
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Print top 20 pitchers by predicted full season WAR}
\FunctionTok{print}\NormalTok{(test\_data }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{select}\NormalTok{(PlayerName, playerid, Age, WAR, Predicted\_Remaining\_WAR, Predicted\_Full\_Season\_WAR) }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{mutate}\NormalTok{(}
          \AttributeTok{WAR\_Improvement =}\NormalTok{ Predicted\_Full\_Season\_WAR }\SpecialCharTok{{-}}\NormalTok{ WAR,}
          \AttributeTok{Improvement\_Percentage =} \FunctionTok{ifelse}\NormalTok{(WAR }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{, (Predicted\_Full\_Season\_WAR }\SpecialCharTok{{-}}\NormalTok{ WAR) }\SpecialCharTok{/} \FunctionTok{abs}\NormalTok{(WAR) }\SpecialCharTok{*} \DecValTok{100}\NormalTok{, }\ConstantTok{Inf}\NormalTok{)}
\NormalTok{        ) }\SpecialCharTok{\%\textgreater{}\%}
        \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(Predicted\_Full\_Season\_WAR)) }\SpecialCharTok{\%\textgreater{}\%}
        \FunctionTok{head}\NormalTok{(}\DecValTok{20}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- MLB Player Pitching Leaders data from FanGraphs.com ------ baseballr 1.6.0 --
\end{verbatim}

\begin{verbatim}
## i Data updated: 2024-07-18 16:56:13 EDT
\end{verbatim}

\begin{verbatim}
## # A tibble: 20 x 8
##    PlayerName playerid   Age   WAR Predicted_Remaining_~1 Predicted_Full_Seaso~2
##    <chr>         <int> <int> <dbl>                  <dbl>                  <dbl>
##  1 Garrett C~    27463    25  3.92                 0.362                    4.28
##  2 Chris Sale    10603    35  3.70                 0.422                    4.12
##  3 Tarik Sku~    22267    27  3.43                 0.372                    3.80
##  4 Tanner Ho~    19879    28  3.39                 0.382                    3.78
##  5 Cole Raga~    21846    26  3.46                 0.312                    3.77
##  6 Cristophe~    20778    27  3.25                 0.403                    3.65
##  7 George Ki~    25436    26  3.28                 0.319                    3.60
##  8 Tyler Gla~    14374    30  3.12                 0.293                    3.41
##  9 Ranger Su~    17277    28  3.00                 0.292                    3.29
## 10 Logan Webb    17995    27  2.89                 0.256                    3.15
## 11 Seth Lugo     12447    34  2.80                 0.347                    3.15
## 12 Logan Gil~    22250    27  2.55                 0.339                    2.89
## 13 Sonny Gray    12768    34  2.95                -0.114                    2.83
## 14 Zack Whee~    10310    34  2.94                -0.233                    2.70
## 15 Corbin Bu~    19361    29  2.64                 0.0177                   2.66
## 16 Dylan Cea~    18525    28  2.54                -0.0748                   2.46
## 17 Erick Fed~    17425    31  2.65                -0.233                    2.42
## 18 Aaron Nola    16149    31  2.11                 0.296                    2.40
## 19 Hunter Gr~    22182    24  2.55                -0.230                    2.32
## 20 Joe Ryan      21390    28  2.58                -0.282                    2.30
## # i abbreviated names: 1: Predicted_Remaining_WAR, 2: Predicted_Full_Season_WAR
## # i 2 more variables: WAR_Improvement <dbl>, Improvement_Percentage <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Print bottom 20 pitchers by predicted full season WAR}
\FunctionTok{print}\NormalTok{(test\_data }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{select}\NormalTok{(PlayerName, playerid, Age, WAR, Predicted\_Remaining\_WAR, Predicted\_Full\_Season\_WAR) }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{mutate}\NormalTok{(}
          \AttributeTok{WAR\_Improvement =}\NormalTok{ Predicted\_Full\_Season\_WAR }\SpecialCharTok{{-}}\NormalTok{ WAR,}
          \AttributeTok{Improvement\_Percentage =} \FunctionTok{ifelse}\NormalTok{(WAR }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{, (Predicted\_Full\_Season\_WAR }\SpecialCharTok{{-}}\NormalTok{ WAR) }\SpecialCharTok{/} \FunctionTok{abs}\NormalTok{(WAR) }\SpecialCharTok{*} \DecValTok{100}\NormalTok{, }\ConstantTok{Inf}\NormalTok{)}
\NormalTok{        ) }\SpecialCharTok{\%\textgreater{}\%}
        \FunctionTok{arrange}\NormalTok{(Predicted\_Full\_Season\_WAR) }\SpecialCharTok{\%\textgreater{}\%}
        \FunctionTok{head}\NormalTok{(}\DecValTok{20}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- MLB Player Pitching Leaders data from FanGraphs.com ------ baseballr 1.6.0 --
\end{verbatim}

\begin{verbatim}
## i Data updated: 2024-07-18 16:56:13 EDT
\end{verbatim}

\begin{verbatim}
## # A tibble: 20 x 8
##    PlayerName        playerid   Age    WAR Predicted_Remaining_WAR
##    <chr>                <int> <int>  <dbl>                   <dbl>
##  1 Triston McKenzie     18000    26 -0.991                 0.240  
##  2 Roddery Muñoz        25311    24 -0.961                 0.282  
##  3 Chris Devenski       12763    33 -0.696                 0.0385 
##  4 Rafael Montero       12760    33 -0.860                 0.261  
##  5 Phil Maton           18064    31 -0.614                 0.0369 
##  6 Jake Diekman          5003    37 -0.659                 0.0879 
##  7 Adbert Alzolay       17859    29 -0.819                 0.263  
##  8 Scott McGough        12056    34 -0.602                 0.0624 
##  9 Nick Nastrini        29833    24 -0.498                -0.0177 
## 10 Yerry Rodríguez      21955    26 -0.542                 0.0281 
## 11 Zach Pop             20185    27 -0.599                 0.0867 
## 12 Giovanny Gallegos    14986    32 -0.613                 0.107  
## 13 Michael Mercado      23223    25 -0.536                 0.0387 
## 14 Wandy Peralta        14295    32 -0.579                 0.0924 
## 15 Tommy Henry          26285    26 -0.482                 0.00667
## 16 Bryce Jarvis         27477    26 -0.633                 0.167  
## 17 Matt Moore            1890    35 -0.419                -0.0435 
## 18 Cade Povich          30055    24 -0.298                -0.140  
## 19 Jordan Leasure       29950    25 -0.390                -0.0113 
## 20 Brandon Hughes       23460    28 -0.574                 0.177  
## # i 3 more variables: Predicted_Full_Season_WAR <dbl>, WAR_Improvement <dbl>,
## #   Improvement_Percentage <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Print summary statistics}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Max current WAR:"}\NormalTok{, }\FunctionTok{max}\NormalTok{(test\_data}\SpecialCharTok{$}\NormalTok{WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Max current WAR: 3.9219"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Min current WAR:"}\NormalTok{, }\FunctionTok{min}\NormalTok{(test\_data}\SpecialCharTok{$}\NormalTok{WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Min current WAR: -0.9907"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Max predicted remaining WAR:"}\NormalTok{, }\FunctionTok{max}\NormalTok{(test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Remaining\_WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Max predicted remaining WAR: 0.421708776582836"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Min predicted remaining WAR:"}\NormalTok{, }\FunctionTok{min}\NormalTok{(test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Remaining\_WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Min predicted remaining WAR: -0.323928318936177"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Max predicted full season WAR:"}\NormalTok{, }\FunctionTok{max}\NormalTok{(test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Full\_Season\_WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Max predicted full season WAR: 4.28372760706654"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Min predicted full season WAR:"}\NormalTok{, }\FunctionTok{min}\NormalTok{(test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Full\_Season\_WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Min predicted full season WAR: -0.750651587382707"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Number of players projected for negative WAR:"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Full\_Season\_WAR }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Number of players projected for negative WAR: 252"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Average predicted remaining WAR:"}\NormalTok{, }\FunctionTok{mean}\NormalTok{(test\_data}\SpecialCharTok{$}\NormalTok{Predicted\_Remaining\_WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Average predicted remaining WAR: 0.0178590304496598"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Now let\textquotesingle{}s predict for the rest of the 2024 season with age{-}based adjustments}
\NormalTok{rest\_of\_season\_2024 }\OtherTok{\textless{}{-}}\NormalTok{ test\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{IP =}\NormalTok{ IP }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{/}\NormalTok{ remaining\_season\_factor }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{),  }\CommentTok{\# Adjust IP for remaining games}
    \AttributeTok{K\_pct =}\NormalTok{ K\_pct }\SpecialCharTok{*} \FunctionTok{runif}\NormalTok{(}\FunctionTok{n}\NormalTok{(), }\FloatTok{0.98}\NormalTok{, }\FloatTok{1.02}\NormalTok{),}
    \AttributeTok{BB\_pct =}\NormalTok{ BB\_pct }\SpecialCharTok{*} \FunctionTok{runif}\NormalTok{(}\FunctionTok{n}\NormalTok{(), }\FloatTok{0.98}\NormalTok{, }\FloatTok{1.02}\NormalTok{),}
    \StringTok{\textasciigrave{}}\AttributeTok{ERA{-}}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{\textasciigrave{}}\AttributeTok{ERA{-}}\StringTok{\textasciigrave{}} \SpecialCharTok{*} \FunctionTok{runif}\NormalTok{(}\FunctionTok{n}\NormalTok{(), }\FloatTok{0.98}\NormalTok{, }\FloatTok{1.02}\NormalTok{),}
    \StringTok{\textasciigrave{}}\AttributeTok{FIP{-}}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{\textasciigrave{}}\AttributeTok{FIP{-}}\StringTok{\textasciigrave{}} \SpecialCharTok{*} \FunctionTok{runif}\NormalTok{(}\FunctionTok{n}\NormalTok{(), }\FloatTok{0.98}\NormalTok{, }\FloatTok{1.02}\NormalTok{),}
    \StringTok{\textasciigrave{}}\AttributeTok{WHIP+}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{\textasciigrave{}}\AttributeTok{WHIP+}\StringTok{\textasciigrave{}} \SpecialCharTok{*} \FunctionTok{runif}\NormalTok{(}\FunctionTok{n}\NormalTok{(), }\FloatTok{0.98}\NormalTok{, }\FloatTok{1.02}\NormalTok{),}
    \AttributeTok{BABIP =}\NormalTok{ BABIP }\SpecialCharTok{*} \FunctionTok{runif}\NormalTok{(}\FunctionTok{n}\NormalTok{(), }\FloatTok{0.99}\NormalTok{, }\FloatTok{1.01}\NormalTok{),}
    \AttributeTok{GB\_pct =}\NormalTok{ GB\_pct }\SpecialCharTok{*} \FunctionTok{runif}\NormalTok{(}\FunctionTok{n}\NormalTok{(), }\FloatTok{0.99}\NormalTok{, }\FloatTok{1.01}\NormalTok{),}
    \AttributeTok{FB\_pct =}\NormalTok{ FB\_pct }\SpecialCharTok{*} \FunctionTok{runif}\NormalTok{(}\FunctionTok{n}\NormalTok{(), }\FloatTok{0.99}\NormalTok{, }\FloatTok{1.01}\NormalTok{),}
    \AttributeTok{Age\_Factor =} \FunctionTok{sapply}\NormalTok{(Age, calculate\_age\_factor),}
    \AttributeTok{ERA\_minus\_inv =} \FunctionTok{inverse\_metric}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{ERA{-}}\StringTok{\textasciigrave{}}\NormalTok{),}
    \AttributeTok{FIP\_minus\_inv =} \FunctionTok{inverse\_metric}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{FIP{-}}\StringTok{\textasciigrave{}}\NormalTok{),}
    \AttributeTok{WHIP\_plus\_inv =} \FunctionTok{inverse\_metric}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{WHIP+}\StringTok{\textasciigrave{}}\NormalTok{),}
    \AttributeTok{is\_starter =} \FunctionTok{as.numeric}\NormalTok{(GS }\SpecialCharTok{\textgreater{}}\NormalTok{ (G }\SpecialCharTok{{-}}\NormalTok{ GS))}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Predict remaining WAR with age adjustment}
\NormalTok{rest\_of\_season\_predictions }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(rf\_model, rest\_of\_season\_2024 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(model\_features)))}
\NormalTok{remaining\_war\_predictions }\OtherTok{\textless{}{-}} \FunctionTok{mapply}\NormalTok{(calculate\_remaining\_war, }
\NormalTok{                                    rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{WAR, }
\NormalTok{                                    rest\_of\_season\_predictions, }
\NormalTok{                                    rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{IP,}
\NormalTok{                                    rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{Age,}
\NormalTok{                                    rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{is\_starter)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Apply success factor and floor}
\NormalTok{success\_factor }\OtherTok{\textless{}{-}} \FunctionTok{pmin}\NormalTok{(rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{WAR }\SpecialCharTok{/} \FloatTok{2.5}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{remaining\_war\_predictions }\OtherTok{\textless{}{-}}\NormalTok{ remaining\_war\_predictions }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{+}\NormalTok{ success\_factor)}
\NormalTok{remaining\_war\_predictions }\OtherTok{\textless{}{-}} \FunctionTok{pmax}\NormalTok{(remaining\_war\_predictions, }\SpecialCharTok{{-}}\FloatTok{1.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Apply age factor}
\NormalTok{remaining\_war\_predictions }\OtherTok{\textless{}{-}}\NormalTok{ remaining\_war\_predictions }\SpecialCharTok{*}\NormalTok{ rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{Age\_Factor}

\CommentTok{\# Add predictions to the dataset}
\NormalTok{rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{Predicted\_Remaining\_WAR }\OtherTok{\textless{}{-}}\NormalTok{ remaining\_war\_predictions}
\NormalTok{rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{Predicted\_Full\_Season\_WAR }\OtherTok{\textless{}{-}}\NormalTok{ rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{WAR }\SpecialCharTok{+}\NormalTok{ remaining\_war\_predictions}

\CommentTok{\# Print top 20 pitchers by predicted full season WAR}
\FunctionTok{print}\NormalTok{(rest\_of\_season\_2024 }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{select}\NormalTok{(PlayerName, playerid, Age, WAR, Predicted\_Remaining\_WAR, Predicted\_Full\_Season\_WAR, Age\_Factor) }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{mutate}\NormalTok{(}
          \AttributeTok{WAR\_Improvement =}\NormalTok{ Predicted\_Full\_Season\_WAR }\SpecialCharTok{{-}}\NormalTok{ WAR,}
          \AttributeTok{Improvement\_Percentage =} \FunctionTok{ifelse}\NormalTok{(WAR }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{, (Predicted\_Full\_Season\_WAR }\SpecialCharTok{{-}}\NormalTok{ WAR) }\SpecialCharTok{/} \FunctionTok{abs}\NormalTok{(WAR) }\SpecialCharTok{*} \DecValTok{100}\NormalTok{, }\ConstantTok{Inf}\NormalTok{)}
\NormalTok{        ) }\SpecialCharTok{\%\textgreater{}\%}
        \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(Predicted\_Full\_Season\_WAR)) }\SpecialCharTok{\%\textgreater{}\%}
        \FunctionTok{head}\NormalTok{(}\DecValTok{20}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- MLB Player Pitching Leaders data from FanGraphs.com ------ baseballr 1.6.0 --
\end{verbatim}

\begin{verbatim}
## i Data updated: 2024-07-18 16:56:13 EDT
\end{verbatim}

\begin{verbatim}
## # A tibble: 20 x 9
##    PlayerName playerid   Age   WAR Predicted_Remaining_~1 Predicted_Full_Seaso~2
##    <chr>         <int> <int> <dbl>                  <dbl>                  <dbl>
##  1 Tarik Sku~    22267    27  3.43                  2.25                    5.68
##  2 Chris Sale    10603    35  3.70                  1.68                    5.37
##  3 Tanner Ho~    19879    28  3.39                  1.53                    4.93
##  4 Garrett C~    27463    25  3.92                  0.997                   4.92
##  5 George Ki~    25436    26  3.28                  1.55                    4.83
##  6 Sonny Gray    12768    34  2.95                  1.86                    4.81
##  7 Cole Raga~    21846    26  3.46                  1.19                    4.64
##  8 Seth Lugo     12447    34  2.80                  1.83                    4.63
##  9 Logan Webb    17995    27  2.89                  1.65                    4.54
## 10 Corbin Bu~    19361    29  2.64                  1.87                    4.52
## 11 Jack Flah~    17479    28  2.11                  2.35                    4.47
## 12 Ranger Su~    17277    28  3.00                  1.34                    4.34
## 13 Tyler Gla~    14374    30  3.12                  1.18                    4.30
## 14 Logan Gil~    22250    27  2.55                  1.62                    4.17
## 15 Erick Fed~    17425    31  2.65                  1.43                    4.08
## 16 Shota Ima~    33829    30  2.28                  1.73                    4.01
## 17 Cristophe~    20778    27  3.25                  0.735                   3.98
## 18 Zack Whee~    10310    34  2.94                  1.02                    3.96
## 19 Joe Ryan      21390    28  2.58                  1.31                    3.89
## 20 Aaron Nola    16149    31  2.11                  1.75                    3.86
## # i abbreviated names: 1: Predicted_Remaining_WAR, 2: Predicted_Full_Season_WAR
## # i 3 more variables: Age_Factor <dbl>, WAR_Improvement <dbl>,
## #   Improvement_Percentage <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Print bottom 20 pitchers by predicted full season WAR}
\FunctionTok{print}\NormalTok{(rest\_of\_season\_2024 }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{select}\NormalTok{(PlayerName, playerid, Age, WAR, Predicted\_Remaining\_WAR, Predicted\_Full\_Season\_WAR, Age\_Factor) }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{mutate}\NormalTok{(}
          \AttributeTok{WAR\_Improvement =}\NormalTok{ Predicted\_Full\_Season\_WAR }\SpecialCharTok{{-}}\NormalTok{ WAR,}
          \AttributeTok{Improvement\_Percentage =} \FunctionTok{ifelse}\NormalTok{(WAR }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{, (Predicted\_Full\_Season\_WAR }\SpecialCharTok{{-}}\NormalTok{ WAR) }\SpecialCharTok{/} \FunctionTok{abs}\NormalTok{(WAR) }\SpecialCharTok{*} \DecValTok{100}\NormalTok{, }\ConstantTok{Inf}\NormalTok{)}
\NormalTok{        ) }\SpecialCharTok{\%\textgreater{}\%}
        \FunctionTok{arrange}\NormalTok{(Predicted\_Full\_Season\_WAR) }\SpecialCharTok{\%\textgreater{}\%}
        \FunctionTok{head}\NormalTok{(}\DecValTok{20}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- MLB Player Pitching Leaders data from FanGraphs.com ------ baseballr 1.6.0 --
\end{verbatim}

\begin{verbatim}
## i Data updated: 2024-07-18 16:56:13 EDT
\end{verbatim}

\begin{verbatim}
## # A tibble: 20 x 9
##    PlayerName        playerid   Age    WAR Predicted_Remaining_WAR
##    <chr>                <int> <int>  <dbl>                   <dbl>
##  1 Triston McKenzie     18000    26 -0.991                 0.141  
##  2 Roddery Muñoz        25311    24 -0.961                 0.141  
##  3 Rafael Montero       12760    33 -0.860                 0.117  
##  4 Chris Devenski       12763    33 -0.696                 0.00825
##  5 Adbert Alzolay       17859    29 -0.819                 0.162  
##  6 Scott McGough        12056    34 -0.602                 0.00666
##  7 Phil Maton           18064    31 -0.614                 0.0249 
##  8 Jake Diekman          5003    37 -0.659                 0.0836 
##  9 Zach Pop             20185    27 -0.599                 0.0409 
## 10 Giovanny Gallegos    14986    32 -0.613                 0.0556 
## 11 Wandy Peralta        14295    32 -0.579                 0.0465 
## 12 Tommy Henry          26285    26 -0.482                -0.0348 
## 13 Nick Nastrini        29833    24 -0.498                -0.00567
## 14 Brandon Hughes       23460    28 -0.574                 0.0747 
## 15 Michael Mercado      23223    25 -0.536                 0.0392 
## 16 Yerry Rodríguez      21955    26 -0.542                 0.0540 
## 17 Bryce Jarvis         27477    26 -0.633                 0.149  
## 18 Connor Brogdon       21205    29 -0.574                 0.0995 
## 19 Thyago Vieira        14510    30 -0.407                -0.0646 
## 20 Matt Moore            1890    35 -0.419                -0.0469 
## # i 4 more variables: Predicted_Full_Season_WAR <dbl>, Age_Factor <dbl>,
## #   WAR_Improvement <dbl>, Improvement_Percentage <dbl>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Print summary statistics for rest\_of\_season\_2024}
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Max current WAR:"}\NormalTok{, }\FunctionTok{max}\NormalTok{(rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Max current WAR: 3.9219"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Min current WAR:"}\NormalTok{, }\FunctionTok{min}\NormalTok{(rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Min current WAR: -0.9907"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Max predicted remaining WAR:"}\NormalTok{, }\FunctionTok{max}\NormalTok{(rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{Predicted\_Remaining\_WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Max predicted remaining WAR: 2.35443787788457"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Min predicted remaining WAR:"}\NormalTok{, }\FunctionTok{min}\NormalTok{(rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{Predicted\_Remaining\_WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Min predicted remaining WAR: -0.190596682571442"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Max predicted full season WAR:"}\NormalTok{, }\FunctionTok{max}\NormalTok{(rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{Predicted\_Full\_Season\_WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Max predicted full season WAR: 5.68290611565861"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Min predicted full season WAR:"}\NormalTok{, }\FunctionTok{min}\NormalTok{(rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{Predicted\_Full\_Season\_WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Min predicted full season WAR: -0.849482123047871"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Number of players projected for negative WAR:"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{Predicted\_Full\_Season\_WAR }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Number of players projected for negative WAR: 246"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Average predicted remaining WAR:"}\NormalTok{, }\FunctionTok{mean}\NormalTok{(rest\_of\_season\_2024}\SpecialCharTok{$}\NormalTok{Predicted\_Remaining\_WAR)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Average predicted remaining WAR: 0.186146733367293"
\end{verbatim}

\end{document}
